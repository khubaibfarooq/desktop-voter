<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Litenode Voting</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #1c1c1e;
      color: #fff;
      font-family: Arial, sans-serif;
    }
    .container {
      max-width: 40%;
      text-align: center;
    }
    .form-control {
      background-color: #333;
      color: #fff;
      border: 1px solid #444;
    }
    .btn {
      background-color: #444;
      border: none;
    }
    .btn:hover {
      background-color: #555;
    }
    .footer-text {
      font-size: 12px;
      color: #777;
      margin-top: 10%;
    }
    .form-control::placeholder {
      color: #a19f9f;
    }
    .stop-button {
    
      color: #007aff;
      border: 2px solid #007aff;
      margin-top: 20px;
      padding: 10px 30px;
    }
    .status-icon {
      background-color: #007bff;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      margin: 0 auto 20px auto;
    }
    .public-key {
      font-size: 0.9rem;
      color: #777;
    }
    .cpu-cores {
      font-size: 0.9rem;
      color: #0d6efd;
    }
    .output {
      border: 1px solid #918e8e;
      background-color: #333;
      padding: 2%;
      margin-top: 5%;
      font-size: 0.8rem;
      border-radius: 8px;
      color: #ddd;
      overflow: auto;
      height: 300px;
    }
    .output::-webkit-scrollbar {
      width: 8px; /* Width of the scrollbar */
    }
    .output::-webkit-scrollbar-track {
      background: #444; /* Background of the scrollbar track */
    }
    .output::-webkit-scrollbar-thumb {
      background-color: #505252; /* Scrollbar color */
      border-radius: 5px; /* Round corners for the scrollbar */
    }
    .output::-webkit-scrollbar-thumb:hover {
      background-color: #505252; /* Color when hovered */
    }
  </style>
</head>
<body>
  <h2 class="ms-5 mt-5">Litenode</h2>
  <div class="container my-5">
    <div id="voting-started"  style="display: none;" >
      <div class="status-icon"></div>
      <h4>Voter is active</h4>
      <div id="status"></div>
      <p class="public-key"></p>
      <p class="cpu-cores">2 cores</p>
    </div>
  <div id="voting-Start">
    <div class="mb-3">
      <label for="publicKey" class="form-label float-start">Public key</label>
      <input type="text" class="form-control" id="publicKeyInput" placeholder="Enter your Xolana public key">
    </div>
    <div class="mb-3">
      <label for="cpuCores" class="form-label float-start">CPU cores</label>
      <div class="input-group">
        <input type="number" class="form-control" id="coreCount" value="1" min="1">
        <button class="btn btn-secondary" type="button" onclick="document.getElementById('coreCount').stepDown()">-</button>
        <button class="btn btn-secondary" type="button" onclick="document.getElementById('coreCount').stepUp()">+</button>
      </div>
    </div>
  </div>
   
      <button type="submit" class="btn btn-primary" id="startBtn">Start voting &#8811;</button>
      <button type="submit" class="stop-button btn" id="stopBtn">Start voting &#8811;</button>

   
  </div>
  <div class="footer-text mx-5">
    <p>Lorem ipsum dolor sit amet consectetur. Nisi dui elit enim et arcu. Nulla integer quam sed adipiscing sit mattis. Lorem ipsum dolor sit amet consectetur, adipisicing elit. Necessitatibus ducimus sapiente modi harum natus nulla facilis suscipit, reprehenderit, vitae repudiandae provident, fugiat in at. Dolores mollitia repellendus numquam totam facilis!</p>
    <p>Lorem ipsum dolor sit amet consectetur. Nisi dui elit enim et arcu. Nulla integer quam sed adipiscing sit mattis.</p>
    <p>Lorem ipsum dolor sit amet consectetur. Nisi dui elit enim et arcu. Nulla integer quam sed adipiscing sit mattis.</p>
  </div>
  <div class="output mt-4 mx-5">
   
  </div>

  <!-- Include Tauri API -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/tauri.js"></script>
    <script>
        const { invoke } = window.__TAURI__.tauri;
        const publicKeyInput = document.getElementById('publicKeyInput');
        const publicKeyInputShow = document.getElementById('public-key');
        const footer = document.getElementById('footer-text');


        const coreCountSelect = document.getElementById('coreCount');
        const Selectedcores = document.getElementById('cpu-cores');

        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const status = document.getElementById('status');
        const log = document.getElementById('output');
        const votingStart = document.getElementById('voting-Start');

        const votingStarted = document.getElementById('voting-Started');


        let isRunning = false;

        // Populate core count options
        invoke('get_available_cores').then((cores) => {
            for (let i = 1; i <= cores; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                coreCountSelect.appendChild(option);
            }
        });

        startBtn.addEventListener('click', async () => {
            const publicKey = publicKeyInput.value.trim();
            const coreCount = parseInt(coreCountSelect.value);
            if (!publicKey) {
                alert('Please enter a valid public key');
                return;
            }
            isRunning = true;
            startBtn.style.display = none;
            votingStart.style.display = none;
            votingStarted.style.display = block;
            stopBtn.style.display = block;
            publicKeyInput.disabled = true;
            coreCountSelect.disabled = true;
            status.textContent = 'Status: Running';
            publicKeyInputShow.textContent = publicKey;
            Selectedcores.textContent = coreCount+" Cores";

            await invoke('start_voter', { publicKey, coreCount });
        });

        stopBtn.addEventListener('click', async () => {
            isRunning = false;
            startBtn.style.display = block;
            votingStart.style.display = block;
            stopBtn.style.display = none;
            publicKeyInput.disabled = false;
            coreCountSelect.disabled = false;
            status.textContent = 'Status: Stopped';
            await invoke('stop_voter');
        });

        function appendToLog(message) {
            const logEntry = typeof message === 'object' ? JSON.stringify(message, null, 2) : message;
            log.textContent += logEntry + '\n';
            log.scrollTop = log.scrollHeight;
        }

        // Listen for log messages from Rust
        window.__TAURI__.event.listen('log', (event) => {
            appendToLog(event.payload.message);
        });
    </script>
</body>
</html>
